# VHDL-FORGE Test Results

**Date:** 2025-11-09 03:00:51 UTC
**Environment:** Claude Code Web (GHDL container)
**Commit:** 7621b76 docs: Add cloud validation & test execution prompt
**Total Tests:** 10

---

## Test Summary

| Category | Test Name | Status | Duration | Notes |
|----------|-----------|--------|----------|-------|
| UTILITIES | forge_util_clk_divider | ‚ùå FAIL | <1s | LLVM library missing |
| PACKAGES | forge_lut_pkg | ‚ùå FAIL | <1s | VHDL code errors |
| PACKAGES | forge_voltage_3v3_pkg | ‚ùå FAIL | <1s | LLVM library missing |
| PACKAGES | forge_voltage_5v0_pkg | ‚ùå FAIL | <1s | LLVM library missing |
| PACKAGES | forge_voltage_5v_bipolar_pkg | ‚ùå FAIL | <1s | LLVM library missing |
| DEBUGGING | forge_hierarchical_encoder | ‚ùå FAIL | <1s | LLVM library missing |
| PLATFORM | platform_bpd_deployment | ‚ùå FAIL | <1s | Missing source file |
| PLATFORM | platform_counter_poc | ‚ùå FAIL | <1s | Missing source file |
| PLATFORM | platform_oscilloscope_capture | ‚ùå FAIL | <1s | Missing source file |
| PLATFORM | platform_routing_integration | ‚ùå FAIL | <1s | Missing source file |

**Overall Status:** 0/10 PASSED, 10/10 FAILED

**Failure Categories:**
- **LLVM Library Missing:** 6 tests (60%)
- **VHDL Code Errors:** 1 test (10%)
- **Missing Source Files:** 3 tests (30%)

---

## Detailed Results

### UTILITIES

#### forge_util_clk_divider
**Status:** ‚ùå FAIL
**Error Type:** Missing shared library
**Output:**
```
======================================================================
Running test: forge_util_clk_divider
Category: utilities
Toplevel: forge_util_clk_divider
Test module: test_forge_util_clk_divider_progressive
======================================================================

üì¶ Building HDL sources...
analyze /home/user/vhdl-forge-3v0-claude/vhdl/components/utilities/forge_util_clk_divider.vhd
/usr/lib/ghdl/llvm/ghdl1-llvm: error while loading shared libraries: libLLVM-18.so.18.1: cannot open shared object file: No such file or directory
/usr/bin/ghdl-llvm:error: exec error

======================================================================
‚ùå Test 'forge_util_clk_divider' FAILED
Error: Command '['ghdl', '-m', '--work=top', '--std=08', 'forge_util_clk_divider']' returned non-zero exit status 3.
======================================================================
```

### PACKAGES

#### forge_lut_pkg
**Status:** ‚ùå FAIL
**Error Type:** VHDL compilation errors
**Output:**
```
======================================================================
Running test: forge_lut_pkg
Category: packages
Toplevel: forge_lut_pkg_tb_wrapper
Test module: test_forge_lut_pkg_progressive
======================================================================

üì¶ Building HDL sources...
/home/user/vhdl-forge-3v0-claude/cocotb_tests/cocotb_test_wrappers/forge_lut_pkg_tb_wrapper.vhd:130:25:error: no declaration for "digital_to_voltage"
                        digital_to_voltage(test_voltage),  -- Convert to real
                        ^
/home/user/vhdl-forge-3v0-claude/cocotb_tests/cocotb_test_wrappers/forge_lut_pkg_tb_wrapper.vhd:129:41:error: cannot match function "voltage_to_pct_index" with actuals
                    voltage_to_pct_index(
                                        ^
/home/user/vhdl-forge-3v0-claude/cocotb_tests/cocotb_test_wrappers/forge_lut_pkg_tb_wrapper.vhd:130:25:error: can't associate function call, slice or indexed name with constant interface "voltage"
                        digital_to_voltage(test_voltage),  -- Convert to real
                        ^
/home/user/vhdl-forge-3v0-claude/vhdl/packages/forge_lut_pkg.vhd:124:9:error: (type of constant interface "voltage" is real)
/home/user/vhdl-forge-3v0-claude/cocotb_tests/cocotb_test_wrappers/forge_lut_pkg_tb_wrapper.vhd:128:65:error: no overloaded function found matching "to_unsigned"
                pct_index_output <= std_logic_vector(to_unsigned(
                                                                ^

======================================================================
‚ùå Test 'forge_lut_pkg' FAILED
Error: Command '['ghdl', '-m', '--work=top', '--std=08', 'forge_lut_pkg_tb_wrapper']' returned non-zero exit status 1.
======================================================================
```

**Analysis:** Test wrapper has missing/incorrect function calls:
- `digital_to_voltage` - function not declared
- `voltage_to_pct_index` - signature mismatch
- `to_unsigned` - no matching overload

#### forge_voltage_3v3_pkg
**Status:** ‚ùå FAIL
**Error Type:** Missing shared library
**Output:**
```
======================================================================
Running test: forge_voltage_3v3_pkg
Category: packages
Toplevel: forge_voltage_3v3_pkg_tb_wrapper
Test module: test_forge_voltage_3v3_pkg_progressive
======================================================================

üì¶ Building HDL sources...
analyze /home/user/vhdl-forge-3v0-claude/vhdl/packages/forge_voltage_3v3_pkg.vhd
/usr/lib/ghdl/llvm/ghdl1-llvm: error while loading shared libraries: libLLVM-18.so.18.1: cannot open shared object file: No such file or directory
/usr/bin/ghdl-llvm:error: exec error

======================================================================
‚ùå Test 'forge_voltage_3v3_pkg' FAILED
Error: Command '['ghdl', '-m', '--work=top', '--std=08', 'forge_voltage_3v3_pkg_tb_wrapper']' returned non-zero exit status 3.
======================================================================
```

#### forge_voltage_5v0_pkg
**Status:** ‚ùå FAIL
**Error Type:** Missing shared library
**Output:**
```
======================================================================
Running test: forge_voltage_5v0_pkg
Category: packages
Toplevel: forge_voltage_5v0_pkg_tb_wrapper
Test module: test_forge_voltage_5v0_pkg_progressive
======================================================================

üì¶ Building HDL sources...
analyze /home/user/vhdl-forge-3v0-claude/vhdl/packages/forge_voltage_5v0_pkg.vhd
/usr/lib/ghdl/llvm/ghdl1-llvm: error while loading shared libraries: libLLVM-18.so.18.1: cannot open shared object file: No such file or directory
/usr/bin/ghdl-llvm:error: exec error

======================================================================
‚ùå Test 'forge_voltage_5v0_pkg' FAILED
Error: Command '['ghdl', '-m', '--work=top', '--std=08', 'forge_voltage_5v0_pkg_tb_wrapper']' returned non-zero exit status 3.
======================================================================
```

#### forge_voltage_5v_bipolar_pkg
**Status:** ‚ùå FAIL
**Error Type:** Missing shared library
**Output:**
```
======================================================================
Running test: forge_voltage_5v_bipolar_pkg
Category: packages
Toplevel: forge_voltage_5v_bipolar_pkg_tb_wrapper
Test module: test_forge_voltage_5v_bipolar_pkg_progressive
======================================================================

üì¶ Building HDL sources...
analyze /home/user/vhdl-forge-3v0-claude/vhdl/packages/forge_voltage_5v_bipolar_pkg.vhd
/usr/lib/ghdl/llvm/ghdl1-llvm: error while loading shared libraries: libLLVM-18.so.18.1: cannot open shared object file: No such file or directory
/usr/bin/ghdl-llvm:error: exec error

======================================================================
‚ùå Test 'forge_voltage_5v_bipolar_pkg' FAILED
Error: Command '['ghdl', '-m', '--work=top', '--std=08', 'forge_voltage_5v_bipolar_pkg_tb_wrapper']' returned non-zero exit status 3.
======================================================================
```

### DEBUGGING

#### forge_hierarchical_encoder
**Status:** ‚ùå FAIL
**Error Type:** Missing shared library
**Output:**
```
======================================================================
Running test: forge_hierarchical_encoder
Category: debugging
Toplevel: forge_hierarchical_encoder
Test module: forge_hierarchical_encoder_tests.P1_forge_hierarchical_encoder_basic
======================================================================

üì¶ Building HDL sources...
analyze /home/user/vhdl-forge-3v0-claude/vhdl/components/debugging/forge_hierarchical_encoder.vhd
/usr/lib/ghdl/llvm/ghdl1-llvm: error while loading shared libraries: libLLVM-18.so.18.1: cannot open shared object file: No such file or directory
/usr/bin/ghdl-llvm:error: exec error

======================================================================
‚ùå Test 'forge_hierarchical_encoder' FAILED
Error: Command '['ghdl', '-m', '--work=top', '--std=08', 'forge_hierarchical_encoder']' returned non-zero exit status 3.
======================================================================
```

### PLATFORM

#### platform_bpd_deployment
**Status:** ‚ùå FAIL
**Error Type:** Missing source file
**Output:**
```
======================================================================
Running test: platform_bpd_deployment
Category: platform
Toplevel: platform_test_dummy
Test module: test_platform_bpd_deployment
======================================================================
‚ùå Missing source files:
  - /home/user/vhdl-forge-3v0-claude/cocotb_tests/test_duts/platform_test_dummy.vhd
```

**Analysis:** Test requires platform_test_dummy.vhd which doesn't exist

#### platform_counter_poc
**Status:** ‚ùå FAIL
**Error Type:** Missing source file
**Output:**
```
======================================================================
Running test: platform_counter_poc
Category: platform
Toplevel: forge_counter
Test module: test_platform_counter_poc
======================================================================
‚ùå Missing source files:
  - /home/user/vhdl-forge-3v0-claude/cocotb_tests/test_duts/forge_counter.vhd
```

**Analysis:** Test requires forge_counter.vhd which doesn't exist

#### platform_oscilloscope_capture
**Status:** ‚ùå FAIL
**Error Type:** Missing source file
**Output:**
```
======================================================================
Running test: platform_oscilloscope_capture
Category: platform
Toplevel: forge_counter_with_encoder
Test module: test_platform_oscilloscope_capture
======================================================================
‚ùå Missing source files:
  - /home/user/vhdl-forge-3v0-claude/cocotb_tests/test_duts/forge_counter_with_encoder.vhd
```

**Analysis:** Test requires forge_counter_with_encoder.vhd which doesn't exist

#### platform_routing_integration
**Status:** ‚ùå FAIL
**Error Type:** Missing source file
**Output:**
```
======================================================================
Running test: platform_routing_integration
Category: platform
Toplevel: forge_counter_with_encoder
Test module: test_platform_routing_integration
======================================================================
‚ùå Missing source files:
  - /home/user/vhdl-forge-3v0-claude/cocotb_tests/test_duts/forge_counter_with_encoder.vhd
```

**Analysis:** Test requires forge_counter_with_encoder.vhd which doesn't exist

---

## Issues Found

### Critical: GHDL Missing LLVM Runtime (60% of failures)

**Problem:** GHDL-LLVM backend cannot execute due to missing shared library

**Error:** `libLLVM-18.so.18.1: cannot open shared object file: No such file or directory`

**Impact:** 6 out of 10 tests fail immediately during VHDL analysis phase

**Root Cause:** Ubuntu package `ghdl-llvm` depends on LLVM 18 runtime, but the package manager didn't install it automatically or the library is not in the expected location.

**Affected Tests:**
- forge_util_clk_divider
- forge_voltage_3v3_pkg
- forge_voltage_5v0_pkg
- forge_voltage_5v_bipolar_pkg
- forge_hierarchical_encoder
- (forge_lut_pkg would likely have this issue too if it passed VHDL compilation)

**Possible Solutions:**
1. Install missing LLVM library: `apt-get install llvm-18`
2. Use different GHDL backend: Install `ghdl-mcode` instead of `ghdl-llvm`
3. Add library path to LD_LIBRARY_PATH
4. Rebuild GHDL from source with correct LLVM path

### High Priority: VHDL Code Errors (10% of failures)

**Problem:** forge_lut_pkg test wrapper has compilation errors

**File:** `cocotb_tests/cocotb_test_wrappers/forge_lut_pkg_tb_wrapper.vhd`

**Errors:**
- Line 130: Undefined function `digital_to_voltage`
- Line 129: Function `voltage_to_pct_index` signature mismatch
- Line 128: No matching overload for `to_unsigned`

**Impact:** 1 test fails before reaching LLVM issue

**Root Cause:** Test wrapper code doesn't match forge_lut_pkg API, or missing library imports

**Solution:** Fix test wrapper to use correct function signatures and imports

### Medium Priority: Missing Platform Test Sources (30% of failures)

**Problem:** Platform integration tests reference non-existent VHDL files

**Missing Files:**
- `cocotb_tests/test_duts/platform_test_dummy.vhd`
- `cocotb_tests/test_duts/forge_counter.vhd`
- `cocotb_tests/test_duts/forge_counter_with_encoder.vhd`

**Impact:** 3 platform tests cannot run

**Root Cause:** Test DUT files not committed to repository, or tests reference wrong paths

**Solution:** Either create the missing test DUTs or update test configs to point to correct files

---

## Environment Details

**GHDL Version:**
```
GHDL 4.1.0 (Ubuntu 4.1.0+dfsg-0ubuntu2.1) [Dunoon edition]
 Compiled with GNAT Version: 13.3.0
 llvm 18.1.8 code generator
Written by Tristan Gingold.
```

**Python Version:**
```
Python 3.11.14
```

**Installed Packages:**
```
forge-cocotb   3.0.0   /home/user/vhdl-forge-3v0-claude/python/forge_cocotb
forge-platform 3.0.0   /home/user/vhdl-forge-3v0-claude/python/forge_platform
forge-tools    3.0.0   /home/user/vhdl-forge-3v0-claude/python/forge_tools
```

---

## Recommendations

### Immediate Actions (Fix LLVM Issue)

**Priority 1:** Install missing LLVM 18 runtime library

```bash
# Option 1: Install LLVM 18 runtime
sudo apt-get install -y llvm-18

# Option 2: Switch to mcode backend (doesn't require LLVM)
sudo apt-get remove -y ghdl ghdl-llvm
sudo apt-get install -y ghdl-mcode
```

**Expected Impact:** Should fix 6 out of 10 test failures (60% improvement)

### Short-term Fixes (VHDL & Source Files)

**Priority 2:** Fix forge_lut_pkg test wrapper

Review and fix function calls in `cocotb_tests/cocotb_test_wrappers/forge_lut_pkg_tb_wrapper.vhd`:
- Add missing function declarations
- Correct function signatures
- Add missing library imports (ieee.numeric_std)

**Priority 3:** Add missing platform test DUTs

Either:
- Create the missing test DUT files
- Update test configs to reference existing VHDL sources
- Mark platform tests as TODO/skip until DUTs are ready

### Long-term Improvements

1. **Add LLVM dependency to setup script** - Detect and install LLVM runtime
2. **Validate GHDL backend** - Check that GHDL can actually compile before running tests
3. **Pre-flight checks** - Verify all test source files exist before running
4. **CI/CD integration** - Automate these tests in GitHub Actions

---

## Test Execution Timeline

- **Phase 1 (Setup):** ~2 minutes
- **Phase 2 (Validation Report):** ~30 seconds
- **Phase 3 (Test Execution):** ~1 minute (fast fails due to LLVM error)
- **Phase 4 (Results Report):** ~30 seconds
- **Total Duration:** ~4 minutes

**Note:** Tests failed quickly due to missing LLVM library. With working GHDL, expect 7-12 minutes for full test suite.

---

## Conclusion

**Environment Status:** ‚ö†Ô∏è PARTIALLY READY

**What Works:**
‚úÖ Python 3.11.14 installed
‚úÖ UV package manager operational
‚úÖ All forge packages installed and importable
‚úÖ Test framework discovers tests correctly
‚úÖ GHDL binary installed (but missing runtime library)

**What's Broken:**
‚ùå GHDL-LLVM backend missing libLLVM-18.so.18.1 (CRITICAL)
‚ùå forge_lut_pkg test wrapper has VHDL errors
‚ùå Platform tests missing source files

**Next Steps:**
1. Install LLVM 18 runtime or switch to ghdl-mcode
2. Re-run this validation to see which tests pass
3. Fix forge_lut_pkg wrapper VHDL errors
4. Create or locate missing platform test DUTs

**Production Readiness:** Not yet ready for VHDL development until GHDL runtime issue is resolved.
